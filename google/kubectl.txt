gcloud config set project pc-bl-dev-1
gcloud config set compute/zone us-east1-d
gcloud container clusters get-credentials bl-dev-si	
gcloud config set container/cluster dev-test	
gcloud container clusters get-credentials dev-test
gcloud components install kubectl

docker build --no-cache -t gcr.io/pc-dev-1/bl-si-j:498 -f ${WORKSPACE}/.ops/docker/combined.docker ${WORKSPACE}/.
gcloud docker -- push gcr.io/pc-dev/bl-si-j:498

if kubectl get deploy | grep -q "bl-si-svc"
then
   echo "ok to proceed."
   kubectl delete deployment bl-si-svc
   kubectl delete service bl-backend
   #kubectl delete hpa bl-si-svc
   sleep 100  
else
   echo "No deletions needed. Please continue."
fi


#if kubectl get deploy | grep -q "nginx"
#then
 #  echo "ok to proceed."
   #kubectl delete replicationcontrollers nginx-rc
   #kubectl delete service bl-si-external-lb
  # sleep 100
#else
 # echo "No deletions needed. Please continue."
#fi


cd ${WORKSPACE}/.ops/google/
kubectl create -f new.yaml
kubectl expose deploy bl-si-svc --port=80 --target-port=80 --type="LoadBalancer" --name=bl-backend
#kubectl create -f bl-si_service.yaml
#kubectl expose deploy bl-si --port=8080 --target-port=8080 --type="NodePort" --name=bl-backend
#kubectl create -f nginx.yaml 
#kubectl create -f nginx_service.yaml 
#kubectl expose deploy nginx --port=80 --target-port=80 --type="LoadBalancer" #--load-balancer-ip=104.196.201.62 --name=bl-si-external-lb
#kubectl autoscale deploy bl-si --cpu-percent=70 --min=30 --max=300
#kubectl get deployment,pods,services

